<!DOCTYPE html>
<html lang="ro">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CompanyIntel.ro - Informa»õii Financiare Complete</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='0.9em' font-size='90'>üè¢</text></svg>">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', 'Helvetica', sans-serif;
            background: #f5f5f5;
            color: #333;
            line-height: 1.6;
        }

        /* Top Bar */
        .top-bar {
            background: #0F7CC0;
            color: white;
            padding: 10px 0;
            font-size: 13px;
        }

        .top-bar .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }

        /* Header */
        .header {
            background: white;
            border-bottom: 3px solid #f78153;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }

        .header .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .logo h1 {
            color: #0F7CC0;
            font-size: 28px;
        }

        .logo .highlight {
            color: #f78153;
        }

        /* Search Section */
        .search-section {
            background: linear-gradient(135deg, #0F7CC0 0%, #0a5a8f 100%);
            padding: 30px 20px;
            color: white;
        }

        .search-section .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        .search-form {
            display: flex;
            gap: 10px;
            max-width: 600px;
        }

        input[type="text"] {
            flex: 1;
            padding: 12px 15px;
            border: none;
            border-radius: 4px;
            font-size: 15px;
        }

        button {
            padding: 12px 30px;
            background: #f78153;
            color: white;
            border: none;
            border-radius: 4px;
            font-size: 15px;
            font-weight: bold;
            cursor: pointer;
        }

        button:hover {
            background: #e56a3d;
        }

        /* Results Container */
        .results-container {
            max-width: 1200px;
            margin: 30px auto;
            padding: 0 20px;
            display: none;
        }

        .results-container.show {
            display: block;
        }

        /* Company Header Card */
        .company-header {
            background: white;
            padding: 25px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }

        .company-name {
            font-size: 26px;
            font-weight: bold;
            color: #0F7CC0;
            margin-bottom: 15px;
        }

        .company-meta {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }

        .meta-item {
            display: flex;
            gap: 10px;
        }

        .meta-label {
            font-weight: 600;
            color: #666;
            min-width: 80px;
        }

        .meta-value {
            color: #333;
        }

        /* Summary Cards */
        .summary-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 30px;
        }

        .summary-card {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            border-left: 4px solid #0F7CC0;
        }

        .summary-card .label {
            font-size: 13px;
            color: #666;
            margin-bottom: 8px;
            text-transform: uppercase;
        }

        .summary-card .value {
            font-size: 24px;
            font-weight: bold;
            color: #0F7CC0;
        }

        .summary-card .change {
            font-size: 13px;
            margin-top: 5px;
        }

        .summary-card .change.positive {
            color: #10b981;
        }

        .summary-card .change.negative {
            color: #ef4444;
        }

        /* Charts Section */
        .charts-section {
            background: white;
            padding: 25px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }

        .section-title {
            font-size: 18px;
            font-weight: bold;
            color: #0F7CC0;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid #f78153;
        }

        /* Compact Table */
        .data-section {
            background: white;
            padding: 25px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }

        .compact-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 13px;
        }

        .compact-table th {
            background: #f5f5f5;
            padding: 10px;
            text-align: left;
            font-weight: 600;
            color: #0F7CC0;
            border-bottom: 2px solid #e0e0e0;
        }

        .compact-table td {
            padding: 10px;
            border-bottom: 1px solid #e0e0e0;
        }

        .compact-table td:first-child {
            font-weight: 600;
            color: #666;
        }

        .compact-table tbody tr:hover {
            background: #f9f9f9;
        }

        .value-cell {
            text-align: right;
            font-family: 'Courier New', monospace;
        }

        .change-indicator {
            font-size: 11px;
            margin-left: 8px;
        }

        .change-indicator.positive {
            color: #10b981;
        }

        .change-indicator.negative {
            color: #ef4444;
        }

        /* Loading */
        .loading {
            text-align: center;
            padding: 60px;
        }

        .loader {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #f78153;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .error {
            background: #fee2e2;
            color: #dc2626;
            padding: 20px;
            border-radius: 4px;
            border-left: 4px solid #dc2626;
        }
    </style>
</head>
<body>
    <div class="top-bar">
        <div class="container">
            üìä 8,390 companii ‚Ä¢ 5,306 cu date complete ‚Ä¢ 12 ani (2013-2024)
        </div>
    </div>

    <div class="header">
        <div class="container">
            <div class="logo">
                <h1>Company<span class="highlight">Intel</span>.ro</h1>
            </div>
        </div>
    </div>

    <div class="search-section">
        <div class="container">
            <h2>CƒÉutare Companie dupƒÉ CIF</h2>
            <form class="search-form" onsubmit="searchCompany(event)">
                <input type="text" id="cifInput" placeholder="Introduce»õi CIF (ex: 29036053)" required>
                <button type="submit">CƒÉutare</button>
            </form>
        </div>
    </div>

    <div class="results-container" id="results">
        <div id="resultsContent"></div>
    </div>

    <script>
        const API_URL = window.location.hostname === 'localhost' ? 'http://localhost:5000/api' : '/api';

        async function searchCompany(event) {
            event.preventDefault();
            console.log('[SEARCH] Starting...');

            const cif = document.getElementById('cifInput').value.trim();
            const resultsContainer = document.getElementById('results');
            const resultsContent = document.getElementById('resultsContent');

            resultsContainer.classList.add('show');
            resultsContent.innerHTML = '<div class="loading"><div class="loader"></div><p>Se √ÆncarcƒÉ...</p></div>';

            try {
                const response = await fetch(`${API_URL}/search?cif=${encodeURIComponent(cif)}`);
                const data = await response.json();

                if (response.ok) {
                    displayResults(data);
                } else {
                    resultsContent.innerHTML = `<div class="error">${data.error}</div>`;
                }
            } catch (error) {
                resultsContent.innerHTML = `<div class="error">Eroare: ${error.message}</div>`;
            }
        }

        function displayResults(data) {
            if (!data.years || data.years.length === 0) {
                document.getElementById('resultsContent').innerHTML = '<div class="error">Nu existƒÉ date disponibile</div>';
                return;
            }

            data.years.sort((a, b) => b.an - a.an);

            let html = '';

            // Company Header
            html += '<div class="company-header">';
            html += `<div class="company-name">${data.company_name || 'CIF ' + data.cif}</div>`;
            html += '<div class="company-meta">';
            html += `<div class="meta-item"><span class="meta-label">CIF:</span><span class="meta-value">${data.cif}</span></div>`;
            if (data.j_number) html += `<div class="meta-item"><span class="meta-label">J:</span><span class="meta-value">${data.j_number}</span></div>`;
            if (data.full_address) html += `<div class="meta-item"><span class="meta-label">AdresƒÉ:</span><span class="meta-value">${data.full_address}</span></div>`;
            if (data.phone) html += `<div class="meta-item"><span class="meta-label">Telefon:</span><span class="meta-value">${data.phone}</span></div>`;
            if (data.cod_caen) html += `<div class="meta-item"><span class="meta-label">COD CAEN:</span><span class="meta-value">${data.cod_caen}</span></div>`;
            html += '</div></div>';

            // Summary Cards (Last year data)
            const lastYear = data.years[0];
            const prevYear = data.years[1] || {};

            html += '<div class="summary-cards">';
            html += createSummaryCard('Cifra de Afaceri', lastYear.cifra_de_afaceri_neta, prevYear.cifra_de_afaceri_neta);
            html += createSummaryCard('Profit Net', lastYear.profit_net, prevYear.profit_net);
            html += createSummaryCard('Angaja»õi', lastYear.salariati, prevYear.salariati, false);
            html += createSummaryCard('Datorii', lastYear.datorii, prevYear.datorii);
            html += '</div>';

            // Charts
            html += '<div class="charts-section">';
            html += '<div class="section-title">üìà Evolu»õie FinanciarƒÉ</div>';
            html += '<canvas id="revenueChart" height="80"></canvas>';
            html += '</div>';

            // Compact Table - Last 5 Years
            html += '<div class="data-section">';
            html += '<div class="section-title">üìä Date Financiare (Ultimii 5 Ani)</div>';
            html += createCompactTable(data.years.slice(0, 5));
            html += '</div>';

            document.getElementById('resultsContent').innerHTML = html;

            // Render chart
            renderChart(data.years);
        }

        function createSummaryCard(label, current, previous, isCurrency = true) {
            const change = previous && current ? ((current - previous) / previous * 100) : 0;
            const changeClass = change > 0 ? 'positive' : (change < 0 ? 'negative' : '');
            const changeSymbol = change > 0 ? '‚Üë' : (change < 0 ? '‚Üì' : '');

            return `
                <div class="summary-card">
                    <div class="label">${label}</div>
                    <div class="value">${formatNumber(current, isCurrency)}</div>
                    ${previous ? `<div class="change ${changeClass}">${changeSymbol} ${Math.abs(change).toFixed(1)}%</div>` : ''}
                </div>
            `;
        }

        function createCompactTable(years) {
            let html = '<table class="compact-table"><thead><tr><th>Indicator</th>';
            years.forEach(y => html += `<th>${y.an}</th>`);
            html += '</tr></thead><tbody>';

            const indicators = [
                {label: 'Cifra de Afaceri NetƒÉ', key: 'cifra_de_afaceri_neta'},
                {label: 'Venituri Totale', key: 'venituri_totale'},
                {label: 'Cheltuieli Totale', key: 'cheltuieli_totale'},
                {label: 'Profit Net', key: 'profit_net', positive: true},
                {label: 'Pierdere Net', key: 'pierdere_net', negative: true},
                {label: 'Active Imobilizate', key: 'active_imobilizate'},
                {label: 'Active Circulante', key: 'active_circulante'},
                {label: 'Datorii', key: 'datorii'},
                {label: 'Salaria»õi', key: 'salariati', isCurrency: false},
            ];

            indicators.forEach(ind => {
                html += `<tr><td>${ind.label}</td>`;
                for (let i = 0; i < years.length; i++) {
                    const current = years[i][ind.key];
                    const previous = i < years.length - 1 ? years[i + 1][ind.key] : null;
                    const change = previous && current ? ((current - previous) / previous * 100) : 0;
                    const changeClass = change > 0 ? 'positive' : (change < 0 ? 'negative' : '');
                    const changeSymbol = change > 0 ? '‚Üë' : (change < 0 ? '‚Üì' : '');

                    let cellClass = '';
                    if (ind.positive) cellClass = 'positive';
                    if (ind.negative) cellClass = 'negative';

                    html += `<td class="value-cell ${cellClass}">`;
                    html += formatNumber(current, ind.isCurrency !== false);
                    if (previous && change !== 0) {
                        html += `<span class="change-indicator ${changeClass}"> ${changeSymbol}${Math.abs(change).toFixed(0)}%</span>`;
                    }
                    html += '</td>';
                }
                html += '</tr>';
            });

            html += '</tbody></table>';
            return html;
        }

        function renderChart(years) {
            const ctx = document.getElementById('revenueChart');
            if (!ctx) return;

            const sortedYears = [...years].sort((a, b) => a.an - b.an);

            new Chart(ctx, {
                type: 'line',
                data: {
                    labels: sortedYears.map(y => y.an),
                    datasets: [
                        {
                            label: 'Cifra de Afaceri',
                            data: sortedYears.map(y => y.cifra_de_afaceri_neta),
                            borderColor: '#0F7CC0',
                            backgroundColor: 'rgba(15, 124, 192, 0.1)',
                            tension: 0.4,
                            fill: true
                        },
                        {
                            label: 'Profit Net',
                            data: sortedYears.map(y => y.profit_net),
                            borderColor: '#10b981',
                            backgroundColor: 'rgba(16, 185, 129, 0.1)',
                            tension: 0.4,
                            fill: true
                        }
                    ]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {position: 'top'},
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return context.dataset.label + ': ' + formatNumber(context.parsed.y, true);
                                }
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                callback: function(value) {
                                    return (value / 1000000).toFixed(1) + 'M';
                                }
                            }
                        }
                    }
                }
            });
        }

        function formatNumber(value, isCurrency = true) {
            if (value === null || value === undefined || value === 0) return '-';
            const num = parseInt(value).toLocaleString('ro-RO');
            return isCurrency ? num + ' RON' : num;
        }
    </script>
</body>
</html>
