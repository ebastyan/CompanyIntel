<!DOCTYPE html>
<html lang="ro">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AnalizƒÉ Sector De»ôeuri - Rom√¢nia</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #333;
            min-height: 100vh;
        }

        .top-bar {
            background: rgba(255, 255, 255, 0.95);
            padding: 15px 30px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            font-size: 24px;
            font-weight: bold;
            color: #0F7CC0;
        }

        .nav-links a {
            margin-left: 20px;
            text-decoration: none;
            color: #555;
            font-weight: 500;
            transition: color 0.3s;
        }

        .nav-links a:hover {
            color: #0F7CC0;
        }

        .container {
            max-width: 1400px;
            margin: 30px auto;
            padding: 0 20px;
        }

        .page-header {
            background: white;
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
        }

        .page-header h1 {
            color: #0F7CC0;
            margin-bottom: 10px;
        }

        .page-header p {
            color: #666;
            font-size: 16px;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: white;
            border-radius: 12px;
            padding: 25px;
            box-shadow: 0 3px 15px rgba(0,0,0,0.08);
            border-left: 4px solid #0F7CC0;
            transition: transform 0.3s;
        }

        .stat-card:hover {
            transform: translateY(-5px);
        }

        .stat-card .label {
            font-size: 14px;
            color: #888;
            margin-bottom: 8px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .stat-card .value {
            font-size: 32px;
            font-weight: bold;
            color: #0F7CC0;
        }

        .stat-card .subvalue {
            font-size: 14px;
            color: #666;
            margin-top: 5px;
        }

        .tabs-container {
            background: white;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
        }

        .tabs {
            display: flex;
            background: #f5f5f5;
            border-bottom: 2px solid #e0e0e0;
            overflow-x: auto;
        }

        .tab {
            padding: 18px 30px;
            cursor: pointer;
            border: none;
            background: transparent;
            font-size: 15px;
            font-weight: 500;
            color: #666;
            transition: all 0.3s;
            white-space: nowrap;
            border-bottom: 3px solid transparent;
        }

        .tab:hover {
            background: rgba(15, 124, 192, 0.05);
            color: #0F7CC0;
        }

        .tab.active {
            background: white;
            color: #0F7CC0;
            border-bottom-color: #0F7CC0;
        }

        .tab-content {
            display: none;
            padding: 30px;
        }

        .tab-content.active {
            display: block;
        }

        .chart-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(500px, 1fr));
            gap: 30px;
            margin-bottom: 30px;
        }

        .chart-container {
            background: #f9f9f9;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }

        .chart-container h3 {
            color: #333;
            margin-bottom: 20px;
            font-size: 18px;
        }

        .data-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            background: white;
            border-radius: 8px;
            overflow: hidden;
        }

        .data-table th {
            background: #0F7CC0;
            color: white;
            padding: 15px;
            text-align: left;
            font-weight: 600;
            position: sticky;
            top: 0;
        }

        .data-table td {
            padding: 12px 15px;
            border-bottom: 1px solid #eee;
        }

        .data-table tr:hover {
            background: #f5f5f5;
        }

        .data-table tr:nth-child(even) {
            background: #fafafa;
        }

        .badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
        }

        .badge.success {
            background: #e7f7e7;
            color: #2d8c2d;
        }

        .badge.warning {
            background: #fff7e6;
            color: #d68910;
        }

        .badge.danger {
            background: #ffeaea;
            color: #c62828;
        }

        .badge.info {
            background: #e7f3ff;
            color: #1565c0;
        }

        .loading {
            text-align: center;
            padding: 50px;
            color: #999;
        }

        .section-title {
            font-size: 20px;
            font-weight: 600;
            color: #333;
            margin: 30px 0 20px 0;
            padding-bottom: 10px;
            border-bottom: 2px solid #0F7CC0;
        }

        .insights-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .insight-card {
            background: linear-gradient(135deg, #0F7CC0 0%, #0a5a8a 100%);
            color: white;
            padding: 25px;
            border-radius: 12px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }

        .insight-card h4 {
            font-size: 16px;
            margin-bottom: 10px;
            opacity: 0.9;
        }

        .insight-card .big-number {
            font-size: 36px;
            font-weight: bold;
            margin: 10px 0;
        }

        .insight-card .description {
            font-size: 14px;
            opacity: 0.85;
        }
    </style>
</head>
<body>
    <!-- Top Navigation -->
    <div class="top-bar">
        <div class="logo">üìä CompanyIntel Rom√¢nia</div>
        <div class="nav-links">
            <a href="index.html">üè† AcasƒÉ</a>
            <a href="analitica.html" style="color: #0F7CC0;">üìà AnalizƒÉ</a>
        </div>
    </div>

    <div class="container">
        <!-- Page Header -->
        <div class="page-header">
            <h1>üìä AnalizƒÉ Sector De»ôeuri Rom√¢nia</h1>
            <p>AnalizƒÉ comprehensivƒÉ a 8,390 companii | Date financiare 2013-2024</p>
        </div>

        <!-- Summary Stats -->
        <div class="stats-grid">
            <div class="stat-card">
                <div class="label">Total Companii Analizate</div>
                <div class="value" id="totalCompanies">8,390</div>
                <div class="subvalue">Cu date financiare complete</div>
            </div>
            <div class="stat-card">
                <div class="label">Jude»õe Acoperite</div>
                <div class="value" id="totalCounties">79</div>
                <div class="subvalue">Acoperire na»õionalƒÉ</div>
            </div>
            <div class="stat-card">
                <div class="label">Scor Mediu SƒÉnƒÉtate</div>
                <div class="value" id="avgHealthScore">49.3</div>
                <div class="subvalue">Pe scalƒÉ 0-100</div>
            </div>
            <div class="stat-card">
                <div class="label">Risc Faliment Ridicat</div>
                <div class="value" id="highRiskCount">232</div>
                <div class="subvalue">Companii √Æn risc √Ænalt</div>
            </div>
        </div>

        <!-- Tabs -->
        <div class="tabs-container">
            <div class="tabs">
                <button class="tab active" onclick="switchTab(0)">üìà Tendin»õe & Cre»ôtere</button>
                <button class="tab" onclick="switchTab(1)">üí™ SƒÉnƒÉtate FinanciarƒÉ</button>
                <button class="tab" onclick="switchTab(2)">üè¢ Segmentare</button>
                <button class="tab" onclick="switchTab(3)">üó∫Ô∏è AnalizƒÉ GeograficƒÉ</button>
                <button class="tab" onclick="switchTab(4)">üîÆ Predic»õii</button>
            </div>

            <!-- TAB 1: Trends -->
            <div class="tab-content active" id="tab1">
                <h2 class="section-title">üìà Analiza Tendin»õelor (2020-2024)</h2>

                <div class="insights-grid">
                    <div class="insight-card">
                        <h4>Top Cre»ôtere CAGR</h4>
                        <div class="big-number" id="topCAGR">-</div>
                        <div class="description" id="topCAGRCompany">Se √ÆncarcƒÉ...</div>
                    </div>
                    <div class="insight-card" style="background: linear-gradient(135deg, #f78153 0%, #d65a2c 100%);">
                        <h4>Impact COVID-19</h4>
                        <div class="big-number" id="covidImpact">-</div>
                        <div class="description" id="covidWinner">Se √ÆncarcƒÉ...</div>
                    </div>
                    <div class="insight-card" style="background: linear-gradient(135deg, #43cea2 0%, #185a9d 100%);">
                        <h4>Top Profitabilitate</h4>
                        <div class="big-number" id="topProfit">-</div>
                        <div class="description" id="topProfitCompany">Se √ÆncarcƒÉ...</div>
                    </div>
                </div>

                <div class="chart-grid">
                    <div class="chart-container">
                        <h3>Top 10 Companii Cre»ôtere RapidƒÉ (CAGR 2020-2024)</h3>
                        <canvas id="chartGrowth"></canvas>
                    </div>
                    <div class="chart-container">
                        <h3>Top 10 Cei Mai Profitabili (2023)</h3>
                        <canvas id="chartProfitable"></canvas>
                    </div>
                </div>

                <h3 class="section-title">üèÜ Top 50 Companii - Cre»ôtere Record</h3>
                <div style="overflow-x: auto;">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Rang</th>
                                <th>CIF</th>
                                <th>Nume Companie</th>
                                <th>CAGR %</th>
                                <th>CifrƒÉ Afaceri 2023</th>
                                <th>Angaja»õi</th>
                            </tr>
                        </thead>
                        <tbody id="tableTrends">
                            <tr><td colspan="6" class="loading">Se √ÆncarcƒÉ datele...</td></tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- TAB 2: Financial Health -->
            <div class="tab-content" id="tab2">
                <h2 class="section-title">üí™ Scor SƒÉnƒÉtate FinanciarƒÉ</h2>

                <div class="insights-grid">
                    <div class="insight-card">
                        <h4>Companii EXCELENTE</h4>
                        <div class="big-number" id="countExcelent">-</div>
                        <div class="description">Scor 80-100 puncte</div>
                    </div>
                    <div class="insight-card" style="background: linear-gradient(135deg, #2ecc71 0%, #27ae60 100%);">
                        <h4>Companii BUNE</h4>
                        <div class="big-number" id="countBun">-</div>
                        <div class="description">Scor 60-80 puncte</div>
                    </div>
                    <div class="insight-card" style="background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);">
                        <h4>RISC √éNALT</h4>
                        <div class="big-number" id="countRisc">-</div>
                        <div class="description">Scor sub 20 puncte</div>
                    </div>
                </div>

                <div class="chart-grid">
                    <div class="chart-container">
                        <h3>Distribu»õie Score SƒÉnƒÉtate FinanciarƒÉ</h3>
                        <canvas id="chartHealthDist"></canvas>
                    </div>
                    <div class="chart-container">
                        <h3>Categorii Risc</h3>
                        <canvas id="chartRiskCategories"></canvas>
                    </div>
                </div>

                <h3 class="section-title">üåü Top 50 Companii - Cea Mai BunƒÉ SƒÉnƒÉtate FinanciarƒÉ</h3>
                <div style="overflow-x: auto;">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Rang</th>
                                <th>CIF</th>
                                <th>Nume Companie</th>
                                <th>Scor</th>
                                <th>Categorie</th>
                                <th>MarjƒÉ Profit %</th>
                                <th>Nivel Risc</th>
                            </tr>
                        </thead>
                        <tbody id="tableHealth">
                            <tr><td colspan="7" class="loading">Se √ÆncarcƒÉ datele...</td></tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- TAB 3: Segmentation -->
            <div class="tab-content" id="tab3">
                <h2 class="section-title">üè¢ Segmentare Companii</h2>

                <div class="insights-grid">
                    <div class="insight-card">
                        <h4>‚≠ê STARS</h4>
                        <div class="big-number" id="countStars">-</div>
                        <div class="description">Profit √Ænalt + Cre»ôtere √ÆnaltƒÉ</div>
                    </div>
                    <div class="insight-card" style="background: linear-gradient(135deg, #f39c12 0%, #e67e22 100%);">
                        <h4>üêÆ CASH COWS</h4>
                        <div class="big-number" id="countCashCows">-</div>
                        <div class="description">Profit √Ænalt + Cre»ôtere moderatƒÉ</div>
                    </div>
                    <div class="insight-card" style="background: linear-gradient(135deg, #9b59b6 0%, #8e44ad 100%);">
                        <h4>‚ùì QUESTION MARKS</h4>
                        <div class="big-number" id="countQuestions">-</div>
                        <div class="description">Profit scƒÉzut + Cre»ôtere √ÆnaltƒÉ</div>
                    </div>
                </div>

                <div class="chart-grid">
                    <div class="chart-container">
                        <h3>Distribu»õie MƒÉrime Companie</h3>
                        <canvas id="chartSize"></canvas>
                    </div>
                    <div class="chart-container">
                        <h3>Specializare CAEN</h3>
                        <canvas id="chartCAEN"></canvas>
                    </div>
                </div>

                <div class="chart-grid">
                    <div class="chart-container" style="grid-column: 1 / -1;">
                        <h3>Matrice BCG - Model de Business</h3>
                        <canvas id="chartBCG"></canvas>
                    </div>
                </div>

                <h3 class="section-title">‚≠ê Top 20 STARS - Cele Mai Promi»õƒÉtoare</h3>
                <div style="overflow-x: auto;">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>CIF</th>
                                <th>Nume</th>
                                <th>MƒÉrime</th>
                                <th>Specializare</th>
                                <th>MarjƒÉ Profit %</th>
                                <th>Cre»ôtere %</th>
                            </tr>
                        </thead>
                        <tbody id="tableStars">
                            <tr><td colspan="6" class="loading">Se √ÆncarcƒÉ datele...</td></tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- TAB 4: Geography -->
            <div class="tab-content" id="tab4">
                <h2 class="section-title">üó∫Ô∏è AnalizƒÉ GeograficƒÉ pe Jude»õe</h2>

                <div class="chart-grid">
                    <div class="chart-container">
                        <h3>Top 15 Jude»õe - Total CifrƒÉ Afaceri</h3>
                        <canvas id="chartCountiesRevenue"></canvas>
                    </div>
                    <div class="chart-container">
                        <h3>Top 15 Jude»õe - NumƒÉr Companii</h3>
                        <canvas id="chartCountiesCount"></canvas>
                    </div>
                </div>

                <h3 class="section-title">üìä Statistici pe Jude»õe</h3>
                <div style="overflow-x: auto;">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Jude»õ</th>
                                <th>Nr. Companii</th>
                                <th>CifrƒÉ Afaceri TotalƒÉ (RON)</th>
                                <th>CifrƒÉ Medie (RON)</th>
                                <th>Total Angaja»õi</th>
                                <th>Angaja»õi Mediu</th>
                            </tr>
                        </thead>
                        <tbody id="tableCounties">
                            <tr><td colspan="6" class="loading">Se √ÆncarcƒÉ datele...</td></tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- TAB 5: Predictions -->
            <div class="tab-content" id="tab5">
                <h2 class="section-title">üîÆ Predic»õii & Risc Faliment</h2>

                <div class="insights-grid">
                    <div class="insight-card" style="background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);">
                        <h4>‚ö†Ô∏è RISC √éNALT Faliment</h4>
                        <div class="big-number" id="highRiskBankruptcy">-</div>
                        <div class="description">Scor risc >70/100</div>
                    </div>
                    <div class="insight-card" style="background: linear-gradient(135deg, #f39c12 0%, #e67e22 100%);">
                        <h4>‚ö† RISC MEDIU</h4>
                        <div class="big-number" id="medRiskBankruptcy">-</div>
                        <div class="description">Scor risc 50-70</div>
                    </div>
                    <div class="insight-card" style="background: linear-gradient(135deg, #16a085 0%, #138d75 100%);">
                        <h4>üöÄ Top Previziune Cre»ôtere</h4>
                        <div class="big-number" id="topPredGrowth">-</div>
                        <div class="description" id="topPredCompany">Pentru 2025</div>
                    </div>
                </div>

                <h3 class="section-title">‚ö†Ô∏è Top 50 Companii - RISC RIDICAT Faliment</h3>
                <div style="overflow-x: auto;">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Rang</th>
                                <th>CIF</th>
                                <th>Nume</th>
                                <th>Scor Risc</th>
                                <th>Nivel</th>
                                <th>Factori Risc</th>
                            </tr>
                        </thead>
                        <tbody id="tableBankruptcy">
                            <tr><td colspan="6" class="loading">Se √ÆncarcƒÉ datele...</td></tr>
                        </tbody>
                    </table>
                </div>

                <h3 class="section-title">üöÄ Top 50 Predic»õii Cre»ôtere 2025</h3>
                <div style="overflow-x: auto;">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Rang</th>
                                <th>CIF</th>
                                <th>Nume</th>
                                <th>CifrƒÉ 2023</th>
                                <th>Predic»õie 2025</th>
                                <th>Cre»ôtere %</th>
                            </tr>
                        </thead>
                        <tbody id="tablePredictions">
                            <tr><td colspan="6" class="loading">Se √ÆncarcƒÉ datele...</td></tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Global data storage
        let analyticsData = null;

        // Tab switching
        function switchTab(index) {
            const tabs = document.querySelectorAll('.tab');
            const contents = document.querySelectorAll('.tab-content');

            tabs.forEach((tab, i) => {
                if (i === index) {
                    tab.classList.add('active');
                    contents[i].classList.add('active');
                } else {
                    tab.classList.remove('active');
                    contents[i].classList.remove('active');
                }
            });
        }

        // Load analytics data
        async function loadAnalytics() {
            try {
                const response = await fetch('analytics_results.json');
                analyticsData = await response.json();

                updateDashboard();
            } catch (error) {
                console.error('Error loading analytics:', error);
                alert('Eroare la √ÆncƒÉrcarea datelor de analizƒÉ. Asigura»õi-vƒÉ cƒÉ analytics_engine.py a fost rulat.');
            }
        }

        // Update dashboard with data
        function updateDashboard() {
            if (!analyticsData) return;

            // Update summary stats
            document.getElementById('totalCounties').textContent = analyticsData.geography.total_counties;
            document.getElementById('avgHealthScore').textContent = analyticsData.financial_health.average_score.toFixed(1);
            document.getElementById('highRiskCount').textContent = analyticsData.timeseries.high_risk_count;

            // Update Tab 1 - Trends
            updateTrendsTab();

            // Update Tab 2 - Financial Health
            updateHealthTab();

            // Update Tab 3 - Segmentation
            updateSegmentationTab();

            // Update Tab 4 - Geography
            updateGeographyTab();

            // Update Tab 5 - Predictions
            updatePredictionsTab();
        }

        // TAB 1: TRENDS
        function updateTrendsTab() {
            const trends = analyticsData.trends;

            // Update insights
            if (trends.fastest_growth.length > 0) {
                const top = trends.fastest_growth[0];
                document.getElementById('topCAGR').textContent = top.cagr.toFixed(1) + '%';
                document.getElementById('topCAGRCompany').textContent = top.name;
            }

            if (trends.covid_winners.length > 0) {
                const winner = trends.covid_winners[0];
                document.getElementById('covidImpact').textContent = '+' + winner.covid_impact.toFixed(0) + '%';
                document.getElementById('covidWinner').textContent = winner.name;
            }

            if (trends.most_profitable.length > 0) {
                const prof = trends.most_profitable[0];
                document.getElementById('topProfit').textContent = formatRON(prof.profit_2023);
                document.getElementById('topProfitCompany').textContent = prof.name;
            }

            // Growth Chart
            const topGrowth = trends.fastest_growth.slice(0, 10);
            new Chart(document.getElementById('chartGrowth'), {
                type: 'bar',
                data: {
                    labels: topGrowth.map(c => 'CIF ' + c.cif),
                    datasets: [{
                        label: 'CAGR %',
                        data: topGrowth.map(c => c.cagr),
                        backgroundColor: '#0F7CC0'
                    }]
                },
                options: {
                    responsive: true,
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: { display: true, text: 'CAGR %' }
                        }
                    }
                }
            });

            // Profitable Chart
            const topProf = trends.most_profitable.slice(0, 10);
            new Chart(document.getElementById('chartProfitable'), {
                type: 'bar',
                data: {
                    labels: topProf.map(c => 'CIF ' + c.cif),
                    datasets: [{
                        label: 'Profit Net (RON)',
                        data: topProf.map(c => c.profit_2023),
                        backgroundColor: '#43cea2'
                    }]
                },
                options: {
                    responsive: true,
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                callback: value => formatRON(value)
                            }
                        }
                    }
                }
            });

            // Table
            const table = document.getElementById('tableTrends');
            table.innerHTML = trends.fastest_growth.slice(0, 50).map((c, i) => `
                <tr>
                    <td>${i + 1}</td>
                    <td>${c.cif}</td>
                    <td>${c.name}</td>
                    <td><span class="badge success">${c.cagr.toFixed(1)}%</span></td>
                    <td>${formatRON(c.revenue_2023)}</td>
                    <td>${c.employees_2024}</td>
                </tr>
            `).join('');
        }

        // TAB 2: FINANCIAL HEALTH
        function updateHealthTab() {
            const health = analyticsData.financial_health;
            const categories = health.categories;

            document.getElementById('countExcelent').textContent = categories['EXCELENT'] || 0;
            document.getElementById('countBun').textContent = categories['BUN'] || 0;
            document.getElementById('countRisc').textContent = categories['RISC √éNALT'] || 0;

            // Distribution chart
            new Chart(document.getElementById('chartHealthDist'), {
                type: 'line',
                data: {
                    labels: health.top_50.map((_, i) => i + 1),
                    datasets: [{
                        label: 'Scor SƒÉnƒÉtate',
                        data: health.top_50.map(c => c.score),
                        borderColor: '#0F7CC0',
                        backgroundColor: 'rgba(15, 124, 192, 0.1)',
                        fill: true
                    }]
                },
                options: {
                    responsive: true,
                    scales: {
                        y: {
                            beginAtZero: true,
                            max: 100
                        }
                    }
                }
            });

            // Categories pie
            new Chart(document.getElementById('chartRiskCategories'), {
                type: 'doughnut',
                data: {
                    labels: Object.keys(categories),
                    datasets: [{
                        data: Object.values(categories),
                        backgroundColor: ['#2ecc71', '#3498db', '#f39c12', '#e74c3c', '#95a5a6']
                    }]
                },
                options: {
                    responsive: true
                }
            });

            // Table
            const table = document.getElementById('tableHealth');
            table.innerHTML = health.top_50.map((c, i) => {
                let categoryClass = c.category === 'EXCELENT' ? 'success' :
                                   c.category === 'BUN' ? 'info' :
                                   c.category === 'MODERAT' ? 'warning' : 'danger';

                return `
                    <tr>
                        <td>${i + 1}</td>
                        <td>${c.cif}</td>
                        <td>${c.name}</td>
                        <td><strong>${c.score}</strong>/100</td>
                        <td><span class="badge ${categoryClass}">${c.category}</span></td>
                        <td>${c.profit_margin.toFixed(1)}%</td>
                        <td>${c.risk}</td>
                    </tr>
                `;
            }).join('');
        }

        // TAB 3: SEGMENTATION
        function updateSegmentationTab() {
            const seg = analyticsData.segmentation;

            // Count business models
            const bcg = seg.business_model_distribution;
            document.getElementById('countStars').textContent = bcg['STAR']?.count || 0;
            document.getElementById('countCashCows').textContent = bcg['CASH COW']?.count || 0;
            document.getElementById('countQuestions').textContent = bcg['QUESTION MARK']?.count || 0;

            // Size chart
            const sizes = seg.size_distribution;
            new Chart(document.getElementById('chartSize'), {
                type: 'pie',
                data: {
                    labels: Object.keys(sizes),
                    datasets: [{
                        data: Object.keys(sizes).map(k => sizes[k].count),
                        backgroundColor: ['#3498db', '#2ecc71', '#f39c12', '#e74c3c']
                    }]
                },
                options: { responsive: true }
            });

            // CAEN chart
            const specs = seg.specialization_distribution;
            new Chart(document.getElementById('chartCAEN'), {
                type: 'bar',
                data: {
                    labels: Object.keys(specs).map(k => k.substring(0, 30)),
                    datasets: [{
                        label: 'Nr. Companii',
                        data: Object.keys(specs).map(k => specs[k].count),
                        backgroundColor: '#f78153'
                    }]
                },
                options: {
                    responsive: true,
                    indexAxis: 'y'
                }
            });

            // BCG Matrix
            new Chart(document.getElementById('chartBCG'), {
                type: 'bar',
                data: {
                    labels: Object.keys(bcg),
                    datasets: [{
                        label: 'NumƒÉr Companii',
                        data: Object.keys(bcg).map(k => bcg[k].count),
                        backgroundColor: ['#f39c12', '#3498db', '#2ecc71', '#95a5a6']
                    }]
                },
                options: { responsive: true }
            });

            // Stars table
            const table = document.getElementById('tableStars');
            table.innerHTML = seg.stars.map(c => `
                <tr>
                    <td>${c.cif}</td>
                    <td>${c.name}</td>
                    <td><span class="badge info">${c.size}</span></td>
                    <td>${c.specialization}</td>
                    <td>${c.profit_margin.toFixed(1)}%</td>
                    <td><span class="badge success">+${c.growth.toFixed(1)}%</span></td>
                </tr>
            `).join('');
        }

        // TAB 4: GEOGRAPHY
        function updateGeographyTab() {
            const geo = analyticsData.geography;

            // Top counties revenue
            const top15Rev = geo.top_counties.slice(0, 15);
            new Chart(document.getElementById('chartCountiesRevenue'), {
                type: 'bar',
                data: {
                    labels: top15Rev.map(c => c.judet),
                    datasets: [{
                        label: 'CifrƒÉ Afaceri (RON)',
                        data: top15Rev.map(c => c.total_revenue),
                        backgroundColor: '#0F7CC0'
                    }]
                },
                options: {
                    responsive: true,
                    indexAxis: 'y',
                    scales: {
                        x: {
                            ticks: {
                                callback: value => formatRON(value)
                            }
                        }
                    }
                }
            });

            // Top counties count
            new Chart(document.getElementById('chartCountiesCount'), {
                type: 'bar',
                data: {
                    labels: top15Rev.map(c => c.judet),
                    datasets: [{
                        label: 'NumƒÉr Companii',
                        data: top15Rev.map(c => c.num_companies),
                        backgroundColor: '#f78153'
                    }]
                },
                options: {
                    responsive: true,
                    indexAxis: 'y'
                }
            });

            // Table
            const table = document.getElementById('tableCounties');
            table.innerHTML = geo.county_stats.map(c => `
                <tr>
                    <td><strong>${c.judet}</strong></td>
                    <td>${c.num_companies}</td>
                    <td>${formatRON(c.total_revenue)}</td>
                    <td>${formatRON(c.avg_revenue)}</td>
                    <td>${c.total_employees.toLocaleString('ro-RO')}</td>
                    <td>${c.avg_employees.toFixed(0)}</td>
                </tr>
            `).join('');
        }

        // TAB 5: PREDICTIONS
        function updatePredictionsTab() {
            const ts = analyticsData.timeseries;

            // Update insights
            document.getElementById('highRiskBankruptcy').textContent = ts.high_risk_count;

            const medRisk = ts.bankruptcy_risks.filter(r => r.risk_score >= 50 && r.risk_score < 70).length;
            document.getElementById('medRiskBankruptcy').textContent = medRisk;

            if (ts.predictions_2025.length > 0) {
                const topPred = ts.predictions_2025[0];
                document.getElementById('topPredGrowth').textContent = '+' + topPred.growth_rate.toFixed(0) + '%';
                document.getElementById('topPredCompany').textContent = topPred.name;
            }

            // Bankruptcy table
            const tableBankr = document.getElementById('tableBankruptcy');
            tableBankr.innerHTML = ts.bankruptcy_risks.slice(0, 50).map((c, i) => `
                <tr>
                    <td>${i + 1}</td>
                    <td>${c.cif}</td>
                    <td>${c.name}</td>
                    <td><strong>${c.risk_score}</strong>/100</td>
                    <td><span class="badge danger">${c.risk_level}</span></td>
                    <td>${c.risk_factors.join(', ')}</td>
                </tr>
            `).join('');

            // Predictions table
            const tablePred = document.getElementById('tablePredictions');
            tablePred.innerHTML = ts.predictions_2025.slice(0, 50).map((c, i) => `
                <tr>
                    <td>${i + 1}</td>
                    <td>${c.cif}</td>
                    <td>${c.name}</td>
                    <td>${formatRON(c.revenue_2023)}</td>
                    <td>${formatRON(c.predicted_2025)}</td>
                    <td><span class="badge success">+${c.growth_rate.toFixed(1)}%</span></td>
                </tr>
            `).join('');
        }

        // Helper: Format RON
        function formatRON(value) {
            if (!value) return '0 RON';
            if (value >= 1000000) return (value / 1000000).toFixed(1) + 'M RON';
            if (value >= 1000) return (value / 1000).toFixed(0) + 'K RON';
            return value.toFixed(0) + ' RON';
        }

        // Load on page load
        window.addEventListener('DOMContentLoaded', loadAnalytics);
    </script>
</body>
</html>
